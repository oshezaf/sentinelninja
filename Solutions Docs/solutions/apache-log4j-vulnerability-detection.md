# Apache Log4j Vulnerability Detection

<img src="https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Solutions/Apache%20Log4j%20Vulnerability%20Detection/Workbooks/Images/Logos/Log4j.svg" alt="Apache Log4j Vulnerability Detection Logo" width="75" height="75">

Microsoft's security research teams have been tracking threats taking advantage of [CVE-2021-44228](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2021-44228), a remote code execution (RCE) vulnerability in [Apache Log4j 2](https://logging.apache.org/log4j/2.x/) referred to as “Log4Shell”. The vulnerability allows unauthenticated remote code execution, and it is triggered when a specially crafted string provided by the attacker through a variety of different input vectors is parsed and processed by the Log4j 2 vulnerable component. For more technical and mitigation information about the vulnerability, please read the [Microsoft Security Response Center blog](https://msrc-blog.microsoft.com/2021/12/11/microsofts-response-to-cve-2021-44228-apache-log4j2/). This solution provides content to monitor, detect and investigate signals related to exploitation of this vulnerability in Microsoft Sentinel.

**Prerequisite :-**

 This is a [domain solution](https://nam06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fdocs.microsoft.com%2Fazure%2Fsentinel%2Fsentinel-solutions-catalog%23domain-solutions&data=05%7C01%7Ckavishbakshi%40microsoft.com%7Cbe2a496082b24caa4b8c08da9cefacca%7C72f988bf86f141af91ab2d7cd011db47%7C1%7C0%7C637994850502413731%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=OJegu%2B2EqD7rmYmK9pm9QniD6YWp5ooloZ6tHzcwVi0%3D&reserved=0) and does not include any data connectors. Install one or more of the listed solutions, or develop your custom ASIM parsers to unlock the value provided by this solution.
 1. Azure Web Application Firewall (WAF) 
 2. Microsoft 365 
 3. Windows Server DNS 
 4. CiscoASA 
 5. PaloAlto-PAN-OS 
 6. Microsoft Entra ID 
 7. Azure Activity 
 8. Amazon Web Services 
 9. Azure Firewall 
 10. SquidProxy 
 11. Zscaler Private Access (ZPA) 
 12. Syslog 
 13. Check Point 
 14. Microsoft Defender XDR

## Solution Information

| Attribute | Value |
|:------------------------|:------|
| **Publisher** | Microsoft Corporation |
| **Support Tier** | Microsoft |
| **Support Link** | [https://support.microsoft.com/](https://support.microsoft.com/) |
| **Categories** | domains |
| **Version** | 3.0.6 |
| **Author** | Microsoft - support@microsoft.com |
| **First Published** | 2021-12-15 |
| **Solution Folder** | [https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Apache%20Log4j%20Vulnerability%20Detection](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Apache%20Log4j%20Vulnerability%20Detection) |
| **Dependencies** | azuresentinel.azure-sentinel-solution-azurewebapplicationfirewal, azuresentinel.azure-sentinel-solution-office365, azuresentinel.azure-sentinel-solution-dns, azuresentinel.azure-sentinel-solution-ciscoasa, azuresentinel.azure-sentinel-solution-paloaltopanos, azuresentinel.azure-sentinel-solution-azureactivedirectory, azuresentinel.azure-sentinel-solution-azureactivity, azuresentinel.azure-sentinel-solution-amazonwebservices, sentinel4azurefirewall.sentinel4azurefirewall, azuresentinel.azure-sentinel-solution-squidproxy, azuresentinel.azure-sentinel-solution-zscalerprivateaccess, azuresentinel.azure-sentinel-solution-syslog, checkpoint.checkpoint-sentinel-solutions, azuresentinel.azure-sentinel-solution-microsoft365defender |

## Data Connectors

**This solution does not include data connectors.**

This solution may contain other components such as analytics rules, workbooks, hunting queries, or playbooks.

## Tables Reference

This solution queries **27 table(s)** from its content items:

| Table | Used By Content |
|-------|----------------|
| [`AADNonInteractiveUserSignInLogs`](../tables/aadnoninteractiveusersigninlogs.md) | Analytics, Workbooks |
| [`ASimWebSessionLogs`](../tables/asimwebsessionlogs.md) | Analytics |
| [`AWSCloudTrail`](../tables/awscloudtrail.md) | Analytics, Workbooks |
| [`AZFWApplicationRule`](../tables/azfwapplicationrule.md) | Analytics |
| [`ApacheHTTPServer_CL`](../tables/apachehttpserver-cl.md) | Analytics |
| [`AzureActivity`](../tables/azureactivity.md) | Analytics |
| [`AzureDiagnostics`](../tables/azurediagnostics.md) | Analytics, Hunting, Workbooks |
| [`CommonSecurityLog`](../tables/commonsecuritylog.md) | Analytics, Hunting |
| [`DeviceNetworkEvents`](../tables/devicenetworkevents.md) | Analytics, Hunting |
| [`DnsEvents`](../tables/dnsevents.md) | Analytics |
| [`Event`](../tables/event.md) | Analytics |
| [`M365SecureScoreControls_CL`](../tables/m365securescorecontrols-cl.md) | Workbooks |
| [`MDfEExposureScore_CL`](../tables/mdfeexposurescore-cl.md) | Workbooks |
| [`MDfERecommendations_CL`](../tables/mdferecommendations-cl.md) | Workbooks |
| [`MDfEVulnerabilitiesList_CL`](../tables/mdfevulnerabilitieslist-cl.md) | Workbooks |
| [`OfficeActivity`](../tables/officeactivity.md) | Analytics, Workbooks |
| [`SecurityNestedRecommendation`](../tables/securitynestedrecommendation.md) | Analytics, Workbooks |
| [`SigninLogs`](../tables/signinlogs.md) | Analytics, Workbooks |
| [`SquidProxy_CL`](../tables/squidproxy-cl.md) | Analytics |
| [`Syslog`](../tables/syslog.md) | Analytics, Hunting, Workbooks |
| [`VMConnection`](../tables/vmconnection.md) | Analytics, Hunting |
| [`VectraStream_CL`](../tables/vectrastream-cl.md) | Analytics |
| [`W3CIISLog`](../tables/w3ciislog.md) | Analytics, Workbooks |
| [`barracuda_CL`](../tables/barracuda-cl.md) | Analytics |
| [`meraki_CL`](../tables/meraki-cl.md) | Analytics |
| [`securescorecontrols`](../tables/securescorecontrols.md) | Workbooks |
| [`securescores`](../tables/securescores.md) | Workbooks |

### Internal Tables

The following **3 table(s)** are used internally by this solution's playbooks:

| Table | Used By Content |
|-------|----------------|
| [`SecurityAlert`](../tables/securityalert.md) | Workbooks |
| [`SecurityIncident`](../tables/securityincident.md) | Workbooks |
| [`Watchlist`](../tables/watchlist.md) | Workbooks |

## Content Items

This solution includes **17 content item(s)**:

| Content Type | Count |
|:-------------|:------|
| Hunting Queries | 10 |
| Analytic Rules | 4 |
| Workbooks | 2 |
| Playbooks | 1 |

### Analytic Rules

| Name | Severity | Tactics | Tables Used |
|:-----|:---------|:--------|:------------|
| [Azure WAF matching for Log4j vuln(CVE-2021-44228)](../content/apache-log4j-vulnerability-detection-azure-waf-matching-for-log4j-vuln-cve-2021-44228-2de8abd6-a613-450e-95ed-08e503369fb3-2f37c37a.md) | High | InitialAccess | [`AzureDiagnostics`](../tables/azurediagnostics.md) |
| [Log4j vulnerability exploit aka Log4Shell IP IOC](../content/apache-log4j-vulnerability-detection-log4j-vulnerability-exploit-aka-log4shell-ip-ioc-6e575295-a7e6-464c-8192-3e1d8fd6a990-c6cdb809.md) | High | CommandAndControl | [`AADNonInteractiveUserSignInLogs`](../tables/aadnoninteractiveusersigninlogs.md)<br>[`AWSCloudTrail`](../tables/awscloudtrail.md)<br>[`AzureActivity`](../tables/azureactivity.md)<br>[`AzureDiagnostics`](../tables/azurediagnostics.md)<br>[`CommonSecurityLog`](../tables/commonsecuritylog.md)<br>[`DeviceNetworkEvents`](../tables/devicenetworkevents.md)<br>[`DnsEvents`](../tables/dnsevents.md)<br>[`Event`](../tables/event.md)<br>[`OfficeActivity`](../tables/officeactivity.md)<br>[`SigninLogs`](../tables/signinlogs.md)<br>[`VMConnection`](../tables/vmconnection.md)<br>[`W3CIISLog`](../tables/w3ciislog.md) |
| [User agent search for log4j exploitation attempt](../content/apache-log4j-vulnerability-detection-user-agent-search-for-log4j-exploitation-attempt-29283b22-a1c0-4d16-b0a9-3460b655a46a-d67cde36.md) | High | InitialAccess | [`AADNonInteractiveUserSignInLogs`](../tables/aadnoninteractiveusersigninlogs.md)<br>[`ASimWebSessionLogs`](../tables/asimwebsessionlogs.md)<br>[`AWSCloudTrail`](../tables/awscloudtrail.md)<br>[`AZFWApplicationRule`](../tables/azfwapplicationrule.md)<br>[`ApacheHTTPServer_CL`](../tables/apachehttpserver-cl.md)<br>[`AzureDiagnostics`](../tables/azurediagnostics.md)<br>[`CommonSecurityLog`](../tables/commonsecuritylog.md)<br>[`OfficeActivity`](../tables/officeactivity.md)<br>[`SigninLogs`](../tables/signinlogs.md)<br>[`SquidProxy_CL`](../tables/squidproxy-cl.md)<br>[`Syslog`](../tables/syslog.md)<br>[`VectraStream_CL`](../tables/vectrastream-cl.md)<br>[`W3CIISLog`](../tables/w3ciislog.md)<br>[`barracuda_CL`](../tables/barracuda-cl.md)<br>[`meraki_CL`](../tables/meraki-cl.md) |
| [Vulnerable Machines related to log4j CVE-2021-44228](../content/apache-log4j-vulnerability-detection-vulnerable-machines-related-to-log4j-cve-2021-44228-3d71fc38-f249-454e-8479-0a358382ef9a-5fca98f8.md) | High | InitialAccess, Execution | [`SecurityNestedRecommendation`](../tables/securitynestedrecommendation.md) |

### Hunting Queries

| Name | Tactics | Tables Used |
|:-----|:--------|:------------|
| [Azure WAF Log4j CVE-2021-44228 hunting](../content/apache-log4j-vulnerability-detection-azure-waf-log4j-cve-2021-44228-hunting-1d4d383e-0ca6-4d3a-a861-8f37aeef18cb-dcfb1bb2.md) | InitialAccess | [`AzureDiagnostics`](../tables/azurediagnostics.md) |
| [Linux security related process termination activity detected](../content/apache-log4j-vulnerability-detection-linux-security-related-process-termination-activity-detected-020b05d3-6447-402c-87b6-f8faff7c7e19-e5bfe56c.md) | DefenseEvasion | [`Syslog`](../tables/syslog.md) |
| [Malicious Connection to LDAP port for CVE-2021-44228 vulnerability](../content/apache-log4j-vulnerability-detection-malicious-connection-to-ldap-port-for-cve-2021-44228-vulnerability-19abc034-139e-4e64-a05d-cb07ce8b003b-ea04e1a2.md) | CommandAndControl | [`DeviceNetworkEvents`](../tables/devicenetworkevents.md)<br>[`VMConnection`](../tables/vmconnection.md) |
| [Network Connection to New External LDAP Server](../content/apache-log4j-vulnerability-detection-network-connection-to-new-external-ldap-server-bf094505-fd2e-484f-b72a-acd79ee00ce8-d9ed48fd.md) | InitialAccess | [`CommonSecurityLog`](../tables/commonsecuritylog.md) |
| [Possible Container Miner related artifacts detected](../content/apache-log4j-vulnerability-detection-possible-container-miner-related-artifacts-detected-6fee32b3-3271-4a3f-9b01-dbd9432a1707-c7bdf860.md) | Impact, Execution | [`Syslog`](../tables/syslog.md) |
| [Possible Linux attack toolkit detected via Syslog data](../content/apache-log4j-vulnerability-detection-possible-linux-attack-toolkit-detected-via-syslog-data-09e45ec6-ac42-4b5a-be69-54623c4aa062-48341e65.md) | Reconnaissance, Execution | [`Syslog`](../tables/syslog.md) |
| [Possible exploitation of Apache log4j component detected](../content/apache-log4j-vulnerability-detection-possible-exploitation-of-apache-log4j-component-detected-38cc38c3-bd6c-470e-ae1a-3136a9ded97f-aa82fa46.md) | Persistence, Execution | [`Syslog`](../tables/syslog.md) |
| [Suspicious Base64 download activity detected](../content/apache-log4j-vulnerability-detection-suspicious-base64-download-activity-detected-78882f9a-f3ef-4010-973c-3f6336f5bef7-90a64218.md) | Persistence, Execution | [`Syslog`](../tables/syslog.md) |
| [Suspicious Shell script detected](../content/apache-log4j-vulnerability-detection-suspicious-shell-script-detected-3e43fe23-c6c0-45ca-b680-263e8afada95-d9c4f52e.md) | Persistence, Execution | [`Syslog`](../tables/syslog.md) |
| [Suspicious manipulation of firewall detected via Syslog data](../content/apache-log4j-vulnerability-detection-suspicious-manipulation-of-firewall-detected-via-syslog-data-e178baf5-3cf3-4960-8ca4-8da6d90d8206-be0d2edd.md) | DefenseEvasion | [`Syslog`](../tables/syslog.md) |

### Workbooks

| Name | Tables Used |
|:-----|:------------|
| [Log4jImpactAssessment](../content/apache-log4j-vulnerability-detection-log4jimpactassessment-68e9e1d6.md) | [`M365SecureScoreControls_CL`](../tables/m365securescorecontrols-cl.md)<br>[`MDfEExposureScore_CL`](../tables/mdfeexposurescore-cl.md)<br>[`MDfERecommendations_CL`](../tables/mdferecommendations-cl.md)<br>[`MDfEVulnerabilitiesList_CL`](../tables/mdfevulnerabilitieslist-cl.md)<br>[`securescorecontrols`](../tables/securescorecontrols.md)<br>[`securescores`](../tables/securescores.md)<br>*Internal use:*<br>[`SecurityAlert`](../tables/securityalert.md)<br>[`SecurityIncident`](../tables/securityincident.md)<br>[`Watchlist`](../tables/watchlist.md) |
| [Log4jPostCompromiseHunting](../content/apache-log4j-vulnerability-detection-log4jpostcompromisehunting-8811d292.md) | [`AADNonInteractiveUserSignInLogs`](../tables/aadnoninteractiveusersigninlogs.md)<br>[`AWSCloudTrail`](../tables/awscloudtrail.md)<br>[`AzureDiagnostics`](../tables/azurediagnostics.md)<br>[`OfficeActivity`](../tables/officeactivity.md)<br>[`SecurityNestedRecommendation`](../tables/securitynestedrecommendation.md)<br>[`SigninLogs`](../tables/signinlogs.md)<br>[`Syslog`](../tables/syslog.md)<br>[`W3CIISLog`](../tables/w3ciislog.md) |

### Playbooks

| Name | Description | Tables Used |
|:-----|:------------|:------------|
| [Log4jIndicatorProcessor](../content/apache-log4j-vulnerability-detection-log4jindicatorprocessor-de71c66e.md) | These playbooks automate the ingest of threat indicators into the ThreatIntelligenceIndicator table ... | - |

## Release Notes

| **Version** | **Date Modified (DD-MM-YYYY)** | **Change History**                                                         |
|-------------|--------------------------------|----------------------------------------------------------------------------|
| 3.0.8       | 25-08-2025                     | Hardcoded the **Watchlist** description to resolve a deployment issue.|
| 3.0.7       | 21-07-2025                     | Removed 'BatchImportToSentinel' & Updated 'Log4jIndicatorProcessor' **Playbook** to handle new STIX action.                 |
| 3.0.6       | 21-01-2025                     | Fixed query in  **Analytical Rule** UserAgentSearch_log4j.yaml.             |
| 3.0.5       | 26-07-2024                     | Updated **Analytical Rule** for missing TTP. 								|
| 3.0.4       | 31-05-2024                     | Added missing AMA **Data Connector** reference in **Analytic rules** and **Hunting Query**.      |
| 3.0.3       | 15-02-2024                     | Updated the solution to fix **Analytic Rules** deployment issue.            |
| 3.0.2       | 07-02-2024                     | Updated solution description.                                               |
| 3.0.1       | 02-01-2024                     | Tagged for dependent solutions for deployment.                              |
| 3.0.0       | 06-11-2023                     | Modified text as there is rebranding from Azure Active Directory to Microsoft Entra ID.   |

---

**Browse:**

- [← Back to Solutions Index](../solutions-index.md)
- [Connectors Index](../connectors-index.md)
- [Tables Index](../tables-index.md)
- [Content Index](../content/content-index.md)
