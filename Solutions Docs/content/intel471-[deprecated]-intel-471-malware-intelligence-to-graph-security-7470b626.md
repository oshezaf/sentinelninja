# [Deprecated] Intel 471 Malware Intelligence to Graph Security

**Browse:** [üè†](../README.md) ¬∑ [Solutions](../solutions-index.md) ¬∑ [Connectors](../connectors-index.md) ¬∑ [Tables](../tables-index.md) ¬∑ [Content](../content/content-index.md) ¬∑ [Parsers](../parsers/parsers-index.md) ¬∑ [ASIM Parsers](../asim/asim-index.md) ¬∑ [ASIM Products](../asim/asim-products-index.md) ¬∑ [üìä](../statistics.md)

‚Üë [Back to Content Index](../content/content-index.md)

---

This playbook ingests malware indicators from Intel 471's Titan API into Microsoft Graph Security as tiIndicator resource type.

| Attribute | Value |
|:----------|:------|
| **Type** | Playbook |
| **Solution** | [Intel471](../solutions/intel471.md) |
| **Source** | [View on GitHub](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Intel471/Playbooks/Intel471-ImportMalwareIntelligenceToGraphSecurity/azuredeploy.json) |

## Additional Documentation

> üìÑ *Source: [Intel471-ImportMalwareIntelligenceToGraphSecurity/readme.md](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Intel471/Playbooks/Intel471-ImportMalwareIntelligenceToGraphSecurity/readme.md)*

# Intel 471 Malware Intelligence import to Microsoft Graph Security

## Table of contents

1. [Overview](#overview)
2. [Prerequisites](#prerequisites)
3. [Deployment instructions](#deployment-instructions)
4. [Post-deployment instructions](#post-deployment-instructions)
5. [Querying Intel 471 Malware Intelligence data in Sentinel](#querying-intel-471-malware-intelligence-data-in-sentinel)
6. [Data mapping](#data-mapping)
7. [Script for granting ThreatIndicators.ReadWrite.OwnedBy role](#script-for-granting-threatindicatorsreadwriteownedby-role)

## Overview

This playbook fetches malware intelligence indicators from the Intel 471's Titan API and ingests them
as [tiIndicators](https://docs.microsoft.com/graph/api/resources/tiindicator?view=graph-rest-beta)
through [Microsoft Graph Security tiIndicators API](https://learn.microsoft.com/azure/sentinel/connect-threat-intelligence-tip) 
to make them available in Microsoft Sentinel and other Microsoft security solutions such as Defender ATP.

Data connector used in this playbook is on a path for deprecation. For new solutions use the new threat intelligence 
upload indicators API data connector, which is used in [Intel471-ImportMalwareIntelligenceToSentinel](..%2FIntel471-ImportMalwareIntelligenceToSentinel) playbook.
For more information, see [Connect your threat intelligence platform to Microsoft Sentinel with the upload indicators API](https://learn.microsoft.com/azure/sentinel/connect-threat-intelligence-upload-api).

[azuredeploy.json](azuredeploy.json) Azure Resource Manager template (ARM template) is responsible
for building the Logic App along with the necessary connections. The ARM builds following components:

- **[Logic App](https://docs.microsoft.com/azure/sentinel/create-custom-connector#connect-with-logic-apps)** responsible for fetching the data from Titan API and ingesting them into `ThreatIntelligenceIndicator` table
- Connection objects
  - Logic app to Blob storage *(authorized automatically)*
  - Logic app to Key Vault *(**requires manual configuration**)*
  - Logic app to Microsoft Security Graph *(**requires manual configuration**)*

![Intel 471 Malware Intelligence Logic App](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Intel471/Playbooks/Intel471-ImportMalwareIntelligenceToGraphSecurity/malware-intelligence-screenshot.png%20%22Intel%20471%20Malware%20Intelligence%20Logic%20App%22)

## Prerequisites

1. An active account in Titan platform, which is available as part of Intel 471's subscriptions. For more information, please contact sales@intel471.com.
2. Titan API credentials.
3. Pre-existing [Key Vault](https://docs.microsoft.com/azure/key-vault/general/basic-concepts) for securely storing Titan API credentials. Store Titan API credentials as secrets under `TitanUserNameGraph` and `TitanAPIKeyGraph` keys.
4. Pre-existing [Blob storage](https://docs.microsoft.com/azure/storage/blobs/storage-blobs-introduction) with blob container for persisting data such as cursor between the API calls.
5. Threat Intelligence connector enabled in Sentinel. Go to Sentinel instance ‚Üí `Content hub` and install `Threat Intelligence` solution.


## Deployment instructions

1. To deploy the Playbook, click the **Deploy to Azure** button. It will launch the ARM Template deployment wizard.
2. Provide following parameters:
    * **Playbook Name**: Either leave the default one or change it as needed
    * **StorageAccountName**: Name of the Storage account (see prerequisites)
    * **StorageAccountContainerName**: Name of the blob container in the Storage account
    * **KeyVaultName**: Name of the Key Vault (see prerequisites)
    * **Target Product**: Security product to which the indicators will be applied. Allowed values: `Azure Sentinel`, `Microsoft Defender ATP`
    * **Action**: The action to apply if the indicator is matched from within the targetProduct security tool. Allowed values: `unknown`, `allow`, `block`, `alert`
    * **Look Back Days**: How many days of history should be pulled on the first run. Leave 0 to start from the current time

    [![Deploy to Azure](https://aka.ms/deploytoazurebutton)](https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2FAzure-Sentinel%2Fmaster%2FSolutions%2FIntel471%2FPlaybooks%2FIntel471-ImportMalwareIntelligenceToGraphSecurity%2Fazuredeploy.json)
    [![Deploy to Azure Gov](https://aka.ms/deploytoazuregovbutton)](https://portal.azure.us/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2FAzure-Sentinel%2Fmaster%2FSolutions%2FIntel471%2FPlaybooks%2FIntel471-ImportMalwareIntelligenceToGraphSecurity%2Fazuredeploy.json)

## Post-deployment instructions

1. Go to the Key Vault. Select `Access control (IAM)` ‚Üí `+ Add` ‚Üí `Add role assignment`. Choose `Key Vault Secrets User`. On the next screen hit `+ Select members`, search for Intel 471 and select newly created logic app. Select it and proceed with granting access rights.

*[Content truncated...]*

---

**Browse:** [üè†](../README.md) ¬∑ [Solutions](../solutions-index.md) ¬∑ [Connectors](../connectors-index.md) ¬∑ [Tables](../tables-index.md) ¬∑ [Content](../content/content-index.md) ¬∑ [Parsers](../parsers/parsers-index.md) ¬∑ [ASIM Parsers](../asim/asim-index.md) ¬∑ [ASIM Products](../asim/asim-products-index.md) ¬∑ [üìä](../statistics.md)

‚Üë [Back to Playbooks](playbooks.md) ¬∑ [Back to Intel471](../solutions/intel471.md)

